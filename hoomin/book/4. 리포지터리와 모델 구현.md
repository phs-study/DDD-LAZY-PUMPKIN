# 리포지터리와 모델 구현

## JPA를 이용한 리포지터리 구현

- 리포지터리 인터페이스는 애그리거트와 같은 도메인 영역, 구현체는 인프라 스트럭처 영역
- 리포지터리 인터페이스는 애그리거트 루트 기준으로 작성

## 매핑 구현

- 애그리거트 루트 : @Entity
- 밸류 : @Embeddable
- 밸류 타입 프러퍼티 : @Embedded
- @Entity 타입 생성자 접근 제어자 설정 필요
- @Converter로 특정 class에 모든 타입 한번에 설정 가능
- @OrderColumn 으로 List 타입일때 index 저장 가능
- 밸류 타입 식별자 사용하면 식별자에 기능을 추가 할 수 있다
    - equals(), hashcode() 구현 필요
- 애그리거트에서 루트 엔티티를 뺀 나머지 구성요소는 대부분 밸류이다
    - 별도 테이블이 있다고 무조건 엔티티는 아니다
    - 앤티티가 확실하다면 다른 애그리거트는 아닌지 확인 필요
        - 자신만의 독자적인 라이프 사이클을 갖으면 애그리거트일 가능성이 높다
        - 함께 생성되고 함께 변경되나? 변경 주체는 같나?
        - 고유 식별자를 갖는가?(테이블 식별자와 다름)
    - 밸류 타입으로 가면 응집도가 높아진다
- 밸류 타입은 부득이하게 @Entity를 사용해도 불변 방식을 사용한다
- 애그리거트간 집합 연관도 id 참조 조인 테이블로 가능하다

## 애그리거트 로딩 전략

- 애그리거트는 개념적으로 하나여야 하지만 루트 엔티티를 로딩하는 시점에 애그리거트에 속한 객체를 모두 로딩해야 하는 것은 아니다

## 애그리거트의 영속성 전파

- 애그리거트는 완전한 상태여야 하므로 같이 저장, 같이 삭제
    - cascadetype 옵션 사용
    
> 응용서비스와 도메인 서비스 설명 (usecase와 entity service?)